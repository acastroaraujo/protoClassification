<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Prototype Model of Classification ‚Ä¢ protoClassification</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Prototype Model of Classification">
<meta name="description" content="Implements the simulation code used in Castro &amp; G√º√©mez (in progress).">
<meta property="og:description" content="Implements the simulation code used in Castro &amp; G√º√©mez (in progress).">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">protoClassification</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/acastroaraujo/protoClassification/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="protoclassification">protoClassification<a class="anchor" aria-label="anchor" href="#protoclassification"></a>
</h1></div>
<!-- badges: start -->

<!-- badges: end -->
<p>Install the development version of protoClassification from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak")</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pak.html" class="external-link">pak</a></span><span class="op">(</span><span class="st">"acastroaraujo/protoClassification"</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="get-started">Get Started<a class="anchor" aria-label="anchor" href="#get-started"></a>
</h2>
<p>To simulate a dataset you need to create to decide a couple of things first.</p>
<ol style="list-style-type: decimal">
<li>The number of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math> dimensions.</li>
<li>The marginal probabilities for each dimension.</li>
<li>A correlation matrix for the dimensions.</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/acastroaraujo/protoClassification" class="external-link">protoClassification</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">6</span> <span class="co"># 1st step</span></span>
<span><span class="va">marginals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="va">K</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span> <span class="co"># 2nd step</span></span>
<span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/rlkjcorr.html">rlkjcorr</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">K</span>, eta <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="co"># 3rd step</span></span></code></pre></div>
<p><strong>Generate data.</strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/make_binary_data.html">make_binary_data</a></span><span class="op">(</span><span class="va">marginals</span>, <span class="va">rho</span>, obs <span class="op">=</span> <span class="fl">1e3</span><span class="op">)</span></span>
<span><span class="va">sim_data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Data ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1000 obs. of  6 variables:</span></span>
<span><span class="co">#&gt;  $ x1: int  0 1 0 1 0 1 0 1 0 1 ...</span></span>
<span><span class="co">#&gt;  $ x2: int  0 1 0 1 1 1 0 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ x3: int  0 1 1 0 1 0 0 0 1 0 ...</span></span>
<span><span class="co">#&gt;  $ x4: int  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ x5: int  1 1 1 1 0 0 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ x6: int  0 1 0 0 1 0 0 1 0 1 ...</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Parameters ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Marginal Probabilities:</span></span>
<span><span class="co">#&gt;   x1   x2   x3   x4   x5   x6 </span></span>
<span><span class="co">#&gt; 0.33 0.55 0.27 0.88 0.59 0.28</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Correlation Matrix:</span></span>
<span><span class="co">#&gt;       x1    x2    x3    x4    x5    x6</span></span>
<span><span class="co">#&gt; x1  1.00  0.22  0.29  0.15 -0.02  0.36</span></span>
<span><span class="co">#&gt; x2  0.22  1.00 -0.08 -0.21 -0.01  0.37</span></span>
<span><span class="co">#&gt; x3  0.29 -0.08  1.00 -0.75  0.34  0.08</span></span>
<span><span class="co">#&gt; x4  0.15 -0.21 -0.75  1.00 -0.20 -0.34</span></span>
<span><span class="co">#&gt; x5 -0.02 -0.01  0.34 -0.20  1.00 -0.03</span></span>
<span><span class="co">#&gt; x6  0.36  0.37  0.08 -0.34 -0.03  1.00</span></span></code></pre></div>
<p><em>Note. The parameters are stored as the <code>params</code> attribute in the output.</em></p>
<p>We can verify that the column means <em>roughly</em> correspond to the marginal probabilities.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;    x1    x2    x3    x4    x5    x6 </span></span>
<span><span class="co">#&gt; 0.326 0.554 0.274 0.899 0.588 0.275</span></span></code></pre></div>
<p>In order to verify that the data follows the correlation structure in <code>rho</code> you would have to calculate a ‚Äú<a href="https://en.wikipedia.org/wiki/Polychoric_correlation" class="external-link">tetrachoric correlation</a>.‚Äù</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">psych</span><span class="fu">::</span><span class="fu">tetrachoric</span><span class="op">(</span><span class="va">sim_data</span><span class="op">)</span><span class="op">$</span><span class="va">rho</span></span>
<span><span class="co">#&gt;             x1          x2          x3         x4          x5          x6</span></span>
<span><span class="co">#&gt; x1  1.00000000  0.23375492  0.28118697  0.1442114 -0.01192531  0.40365755</span></span>
<span><span class="co">#&gt; x2  0.23375492  1.00000000 -0.13315127 -0.1448709  0.03404136  0.38467926</span></span>
<span><span class="co">#&gt; x3  0.28118697 -0.13315127  1.00000000 -0.7612102  0.40485490  0.07792155</span></span>
<span><span class="co">#&gt; x4  0.14421140 -0.14487091 -0.76121019  1.0000000 -0.31759978 -0.34664697</span></span>
<span><span class="co">#&gt; x5 -0.01192531  0.03404136  0.40485490 -0.3175998  1.00000000 -0.08953172</span></span>
<span><span class="co">#&gt; x6  0.40365755  0.38467926  0.07792155 -0.3466470 -0.08953172  1.00000000</span></span></code></pre></div>
<p>Additional stuff for Prototype Classification Model:</p>
<ul>
<li><p><code>w</code> a vector of attention weights for each k</p></li>
<li><p><code>P</code> a list of prototypes, one per category.</p></li>
<li><p><code>g</code> (gamma) sensitivity parameter.</p></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="va">w</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></code></pre></div>
<p>Calculate distance and similarity for one prototype at a time:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/calculateDistSim.html">calculateDistSim</a></span><span class="op">(</span></span>
<span>  P <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">K</span><span class="op">)</span>, </span>
<span>  w <span class="op">=</span> <span class="va">w</span>, </span>
<span>  data <span class="op">=</span> <span class="va">sim_data</span>, </span>
<span>  g <span class="op">=</span> <span class="va">g</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    1000 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;  $ distance  : num  0.655 0 0.477 0.457 0.145 ...</span></span>
<span><span class="co">#&gt;  $ similarity: num  0.00143 1 0.00846 0.01035 0.23423 ...</span></span></code></pre></div>
<p>Calculate distance, similarity, and probabilities for multiple prototypes at the same time:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prototypes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  P1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">K</span><span class="op">)</span>,</span>
<span>  P2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">K</span><span class="op">)</span>,</span>
<span>  P3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">0</span>, <span class="va">K</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute.html">compute</a></span><span class="op">(</span><span class="va">sim_data</span>, <span class="va">prototypes</span>, <span class="va">w</span>, <span class="va">g</span><span class="op">)</span></span>
<span><span class="va">out</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Output ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  $ distance      1000 obs. of  3 variables</span></span>
<span><span class="co">#&gt;  $ similarity    1000 obs. of  3 variables</span></span>
<span><span class="co">#&gt;  $ probabilities 1000 obs. of  3 variables</span></span>
<span><span class="co">#&gt;  $ data          1000 obs. of  6 variables</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Prototypes ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  $ P1: num [1:6] 1 1 1 1 1 1</span></span>
<span><span class="co">#&gt;  $ P2: num [1:6] 0 0 0 0 0 0</span></span>
<span><span class="co">#&gt;  $ P3: int [1:6] 1 0 1 0 1 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Distance ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Manhattan (r = 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Sensitivity ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; g1 g2 g3 </span></span>
<span><span class="co">#&gt; 10 10 10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Attention Weights ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    w1    w2    w3    w4    w5    w6 </span></span>
<span><span class="co">#&gt; 0.082 0.116 0.178 0.282 0.063 0.279</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Marginal Probabilities ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ `colMeans(.$data)`</span></span>
<span><span class="co">#&gt;    x1    x2    x3    x4    x5    x6 </span></span>
<span><span class="co">#&gt; 0.326 0.554 0.274 0.899 0.588 0.275</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ `colMeans(.$probabilities)`</span></span>
<span><span class="co">#&gt;        C1        C2        C3 </span></span>
<span><span class="co">#&gt; 0.3883449 0.4360664 0.1755887</span></span></code></pre></div>
<p><code><a href="reference/consolidate.html">consolidate()</a></code> the previous output into a single data frame for easier visualization.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/consolidate.html">consolidate</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    1000 obs. of  15 variables:</span></span>
<span><span class="co">#&gt;  $ prob1: num  0.0379 0.9988 0.212 0.5783 0.998 ...</span></span>
<span><span class="co">#&gt;  $ prob2: num  8.45e-01 4.53e-05 1.34e-01 2.45e-01 8.26e-04 ...</span></span>
<span><span class="co">#&gt;  $ prob3: num  0.11692 0.00115 0.65354 0.17654 0.00115 ...</span></span>
<span><span class="co">#&gt;  $ sim1 : num  0.00143 1 0.00846 0.01035 0.23423 ...</span></span>
<span><span class="co">#&gt;  $ sim2 : num  3.18e-02 4.54e-05 5.36e-03 4.39e-03 1.94e-04 ...</span></span>
<span><span class="co">#&gt;  $ sim3 : num  0.0044 0.001149 0.026083 0.003159 0.000269 ...</span></span>
<span><span class="co">#&gt;  $ dist1: num  0.655 0 0.477 0.457 0.145 ...</span></span>
<span><span class="co">#&gt;  $ dist2: num  0.345 1 0.523 0.543 0.855 ...</span></span>
<span><span class="co">#&gt;  $ dist3: num  0.543 0.677 0.365 0.576 0.822 ...</span></span>
<span><span class="co">#&gt;  $ x1   : int  0 1 0 1 0 1 0 1 0 1 ...</span></span>
<span><span class="co">#&gt;  $ x2   : int  0 1 0 1 1 1 0 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ x3   : int  0 1 1 0 1 0 0 0 1 0 ...</span></span>
<span><span class="co">#&gt;  $ x4   : int  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ x5   : int  1 1 1 1 0 0 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ x6   : int  0 1 0 0 1 0 0 1 0 1 ...</span></span></code></pre></div>
<p><em>Note. Since only binary data is implemented, there is no difference between Manhattan and Euclidean distance!</em></p>
</div>
<div class="section level2">
<h2 id="marginal-and-conditional-probabilities">Marginal and Conditional Probabilities<a class="anchor" aria-label="anchor" href="#marginal-and-conditional-probabilities"></a>
</h2>
<p>So far, a single simulation requires the marginal probabilities for each element of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ùê±</mi><annotation encoding="application/x-tex">\mathbf{x}</annotation></semantics></math> to be specified at the outset.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">data</span><span class="op">)</span> <span class="co"># cf. `marginals` argument in `make_binary_data()`</span></span>
<span><span class="co">#&gt;    x1    x2    x3    x4    x5    x6 </span></span>
<span><span class="co">#&gt; 0.326 0.554 0.274 0.899 0.588 0.275</span></span></code></pre></div>
<p>The more relevant piece of information we get from the <code><a href="reference/compute.html">compute()</a></code> function is the <code>.$probabilities</code> object, which calculates the probability that any given individual in our simulated dataset will belong to each of the prototype categories.</p>
<p>This allows us to calculate the marginal probabilities for each category.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">probabilities</span><span class="op">)</span></span>
<span><span class="co">#&gt;        C1        C2        C3 </span></span>
<span><span class="co">#&gt; 0.3883449 0.4360664 0.1755887</span></span></code></pre></div>
<p>With some ingenuity, we can use this information to get <em>conditional probabilities</em> too.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>k</mi></msub><mo>=</mo><mn>1</mn><mo>‚à£</mo><mi>C</mi><mo>=</mo><mi>c</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\Pr(X_k = 1 \mid C = c)
</annotation></semantics></math></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/conditionalProbs.html">conditionalProbs</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"features"</span><span class="op">)</span></span>
<span><span class="co">#&gt;           x1        x2         x3        x4        x5         x6</span></span>
<span><span class="co">#&gt; C1 0.5226571 0.7802353 0.32826487 0.9332301 0.6171392 0.62588499</span></span>
<span><span class="co">#&gt; C2 0.1302299 0.4297247 0.05791891 0.9465871 0.4820181 0.03806980</span></span>
<span><span class="co">#&gt; C3 0.3770770 0.3621551 0.69020964 0.7052639 0.7862111 0.08786438</span></span></code></pre></div>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>k</mi></msub><mo>=</mo><mn>0</mn><mo>‚à£</mo><mi>C</mi><mo>=</mo><mi>c</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\Pr(X_k = 0 \mid C = c)
</annotation></semantics></math></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="reference/conditionalProbs.html">conditionalProbs</a></span><span class="op">(</span><span class="va">out</span>, <span class="st">"features"</span><span class="op">)</span></span>
<span><span class="co">#&gt;           x1        x2        x3         x4        x5        x6</span></span>
<span><span class="co">#&gt; C1 0.4769570 0.2200126 0.6714007 0.06717440 0.3829206 0.3734904</span></span>
<span><span class="co">#&gt; C2 0.8703417 0.5706125 0.9425701 0.05316343 0.5189671 0.9620408</span></span>
<span><span class="co">#&gt; C3 0.6227137 0.6362298 0.3103042 0.29413893 0.2117976 0.9130266</span></span></code></pre></div>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>C</mi><mo>=</mo><mi>c</mi><mo>‚à£</mo><msub><mi>X</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\Pr(C = c \mid X_k)
</annotation></semantics></math></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/conditionalProbs.html">conditionalProbs</a></span><span class="op">(</span><span class="va">out</span>, type <span class="op">=</span> <span class="st">"categories"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`Xk=0`</span></span>
<span><span class="co">#&gt;           C1        C2         C3</span></span>
<span><span class="co">#&gt; x1 0.2743383 0.5632908 0.16237092</span></span>
<span><span class="co">#&gt; x2 0.1926099 0.5577848 0.24960538</span></span>
<span><span class="co">#&gt; x3 0.3591157 0.5664215 0.07446281</span></span>
<span><span class="co">#&gt; x4 0.2566337 0.2286733 0.51469307</span></span>
<span><span class="co">#&gt; x5 0.3608689 0.5489563 0.09017476</span></span>
<span><span class="co">#&gt; x6 0.2001655 0.5788414 0.22099310</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Xk=1`</span></span>
<span><span class="co">#&gt;           C1         C2         C3</span></span>
<span><span class="co">#&gt; x1 0.6236135 0.17344785 0.20293865</span></span>
<span><span class="co">#&gt; x2 0.5456643 0.33832130 0.11601444</span></span>
<span><span class="co">#&gt; x3 0.4652701 0.09116788 0.44356204</span></span>
<span><span class="co">#&gt; x4 0.4029833 0.45951724 0.13749944</span></span>
<span><span class="co">#&gt; x5 0.4073537 0.35719728 0.23544898</span></span>
<span><span class="co">#&gt; x6 0.8839345 0.06015273 0.05591273</span></span></code></pre></div>
<p>Alternatively, it‚Äôs easier to use the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function to extract all conditional and marginal probabilities.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="va">probs</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Categories ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Marginals:</span></span>
<span><span class="co">#&gt;    C1    C2    C3 </span></span>
<span><span class="co">#&gt; 0.388 0.436 0.176</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Conditionals:</span></span>
<span><span class="co">#&gt; $`Xk=0`</span></span>
<span><span class="co">#&gt;       C1    C2    C3</span></span>
<span><span class="co">#&gt; x1 0.276 0.562 0.162</span></span>
<span><span class="co">#&gt; x2 0.193 0.558 0.249</span></span>
<span><span class="co">#&gt; x3 0.360 0.565 0.075</span></span>
<span><span class="co">#&gt; x4 0.258 0.231 0.511</span></span>
<span><span class="co">#&gt; x5 0.362 0.548 0.091</span></span>
<span><span class="co">#&gt; x6 0.202 0.578 0.220</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`Xk=1`</span></span>
<span><span class="co">#&gt;       C1    C2    C3</span></span>
<span><span class="co">#&gt; x1 0.624 0.173 0.202</span></span>
<span><span class="co">#&gt; x2 0.548 0.337 0.116</span></span>
<span><span class="co">#&gt; x3 0.467 0.092 0.441</span></span>
<span><span class="co">#&gt; x4 0.404 0.458 0.137</span></span>
<span><span class="co">#&gt; x5 0.409 0.357 0.234</span></span>
<span><span class="co">#&gt; x6 0.884 0.060 0.056</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Features ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Marginals:</span></span>
<span><span class="co">#&gt;    x1    x2    x3    x4    x5    x6 </span></span>
<span><span class="co">#&gt; 0.326 0.554 0.274 0.899 0.588 0.275</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Conditionals:</span></span>
<span><span class="co">#&gt;       x1    x2    x3    x4    x5    x6</span></span>
<span><span class="co">#&gt; C1 0.523 0.779 0.329 0.933 0.618 0.625</span></span>
<span><span class="co">#&gt; C2 0.129 0.429 0.057 0.946 0.480 0.038</span></span>
<span><span class="co">#&gt; C3 0.378 0.364 0.691 0.705 0.788 0.088</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="compositional-effects">Compositional Effects<a class="anchor" aria-label="anchor" href="#compositional-effects"></a>
</h2>
<p>Our main goal is to compare different probabilities across different parameters values. In particular, we can measure the ‚Äúcompositional effects‚Äù that result from different parameter values by keeping track of these conditional probabilities: <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Pr</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ùê±</mi><mo>‚à£</mo><mi>C</mi><mo>,</mo><mi>Œ©</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\Pr(\mathbf{x} \mid C, \Omega)</annotation></semantics></math>, where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ©</mi><annotation encoding="application/x-tex">\Omega</annotation></semantics></math> is a short-hand way of referring to all parameters in the prototype model.</p>
<p>Here I provide a few examples.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">9</span><span class="op">)</span></span>
<span><span class="co"># Basic Workflow ----</span></span>
<span></span>
<span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">10</span> </span>
<span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fl">1e3</span></span>
<span></span>
<span><span class="co"># Data ----</span></span>
<span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="va">K</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span> </span>
<span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/rlkjcorr.html">rlkjcorr</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">K</span>, eta <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/make_binary_data.html">make_binary_data</a></span><span class="op">(</span><span class="va">mu</span>, <span class="va">rho</span>, <span class="va">obs</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prototype Parameters ----</span></span>
<span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="va">w</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prototypes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  P1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">K</span><span class="op">)</span>,</span>
<span>  P2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">K</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute ----</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute.html">compute</a></span><span class="op">(</span><span class="va">sim_data</span>, <span class="va">prototypes</span>, <span class="va">w</span>, <span class="va">g</span><span class="op">)</span></span>
<span><span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">out</span>, s <span class="op">=</span> <span class="fl">1e3</span><span class="op">)</span></span></code></pre></div>
<p><strong>Changing</strong> <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œ≥</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This should make the second category more inclusive</span></span>
<span><span class="va">new_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute.html">compute</a></span><span class="op">(</span><span class="va">sim_data</span>, <span class="va">prototypes</span>, <span class="va">w</span>, g <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">new_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">new_out</span>, s <span class="op">=</span> <span class="fl">1e3</span><span class="op">)</span></span></code></pre></div>
<p>This should increase the marginal probabilities of the second category.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">categories</span></span>
<span><span class="co">#&gt;        C1        C2 </span></span>
<span><span class="co">#&gt; 0.3467094 0.6532906</span></span>
<span><span class="va">new_probs</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">categories</span></span>
<span><span class="co">#&gt;        C1        C2 </span></span>
<span><span class="co">#&gt; 0.1272612 0.8727388</span></span></code></pre></div>
<p>And these are the compositional effects:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span></span>
<span><span class="co">#&gt;           x1        x2        x3        x4        x5        x6        x7</span></span>
<span><span class="co">#&gt; C1 0.5728644 0.5546241 0.4564499 0.5167535 0.8871769 0.3245671 0.8346980</span></span>
<span><span class="co">#&gt; C2 0.1476666 0.1344176 0.4190103 0.4130322 0.5257202 0.1370018 0.8030352</span></span>
<span><span class="co">#&gt;           x8        x9       x10</span></span>
<span><span class="co">#&gt; C1 0.5830473 0.3673473 0.4692927</span></span>
<span><span class="co">#&gt; C2 0.4483320 0.4632084 0.3647565</span></span>
<span><span class="va">new_probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span></span>
<span><span class="co">#&gt;           x1        x2        x3        x4        x5        x6        x7</span></span>
<span><span class="co">#&gt; C1 0.6926339 0.7162739 0.4362536 0.5256324 0.9326090 0.3853025 0.8662932</span></span>
<span><span class="co">#&gt; C2 0.2370709 0.2164392 0.4313787 0.4378470 0.6099313 0.1753121 0.8064060</span></span>
<span><span class="co">#&gt;           x8        x9       x10</span></span>
<span><span class="co">#&gt; C1 0.6368593 0.3008669 0.4785071</span></span>
<span><span class="co">#&gt; C2 0.4743415 0.4487705 0.3897002</span></span>
<span></span>
<span><span class="co"># diff-in-prob</span></span>
<span><span class="va">new_probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span> <span class="op">-</span> <span class="va">probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span></span>
<span><span class="co">#&gt;            x1         x2          x3          x4         x5         x6</span></span>
<span><span class="co">#&gt; C1 0.11976955 0.16164978 -0.02019631 0.008878864 0.04543211 0.06073539</span></span>
<span><span class="co">#&gt; C2 0.08940431 0.08202158  0.01236839 0.024814811 0.08421110 0.03831033</span></span>
<span><span class="co">#&gt;             x7         x8          x9         x10</span></span>
<span><span class="co">#&gt; C1 0.031595164 0.05381202 -0.06648039 0.009214365</span></span>
<span><span class="co">#&gt; C2 0.003370833 0.02600956 -0.01443787 0.024943624</span></span>
<span><span class="co"># risk ratio</span></span>
<span><span class="va">new_probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span> <span class="op">/</span> <span class="va">probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span></span>
<span><span class="co">#&gt;          x1       x2        x3       x4       x5       x6       x7       x8</span></span>
<span><span class="co">#&gt; C1 1.209071 1.291458 0.9557535 1.017182 1.051210 1.187127 1.037852 1.092294</span></span>
<span><span class="co">#&gt; C2 1.605447 1.610200 1.0295181 1.060080 1.160182 1.279634 1.004198 1.058014</span></span>
<span><span class="co">#&gt;           x9      x10</span></span>
<span><span class="co">#&gt; C1 0.8190258 1.019635</span></span>
<span><span class="co">#&gt; C2 0.9688307 1.068384</span></span></code></pre></div>
<p><strong>Changing the ‚Äúattention weights‚Äù</strong></p>
<p>1st, we can make the attention weights more selective, meaning that classification becomes more rule-like.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/temperature.html">temperature</a></span><span class="op">(</span><span class="va">w</span>, temp <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span> <span class="co"># cf. "temperature sampling"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">w</span>, names.arg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Original Weights"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-20-1.png" width="100%"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">w2</span>, names.arg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"New Weights"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-20-2.png" width="100%"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">new_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute.html">compute</a></span><span class="op">(</span><span class="va">sim_data</span>, <span class="va">prototypes</span>, w <span class="op">=</span> <span class="va">w2</span>, <span class="va">g</span><span class="op">)</span></span>
<span><span class="va">new_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">new_out</span>, s <span class="op">=</span> <span class="fl">1e3</span><span class="op">)</span></span></code></pre></div>
<p>The change in compositional effects should make it such that the new <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>k</mi></msub><mo>‚à£</mo><mi>c</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(x_k \mid c)</annotation></semantics></math> are very high when <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>k</mi></msub><annotation encoding="application/x-tex">x_k</annotation></semantics></math> is highly weighted.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span></span>
<span><span class="co">#&gt;           x1        x2        x3        x4        x5        x6        x7</span></span>
<span><span class="co">#&gt; C1 0.5728644 0.5546241 0.4564499 0.5167535 0.8871769 0.3245671 0.8346980</span></span>
<span><span class="co">#&gt; C2 0.1476666 0.1344176 0.4190103 0.4130322 0.5257202 0.1370018 0.8030352</span></span>
<span><span class="co">#&gt;           x8        x9       x10</span></span>
<span><span class="co">#&gt; C1 0.5830473 0.3673473 0.4692927</span></span>
<span><span class="co">#&gt; C2 0.4483320 0.4632084 0.3647565</span></span>
<span><span class="va">new_probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span></span>
<span><span class="co">#&gt;           x1         x2        x3        x4        x5        x6        x7</span></span>
<span><span class="co">#&gt; C1 0.4860178 0.86941998 0.3071452 0.3394442 0.7586206 0.2901795 0.9158345</span></span>
<span><span class="co">#&gt; C2 0.2139871 0.03015844 0.4849078 0.4954442 0.6053495 0.1646123 0.7708265</span></span>
<span><span class="co">#&gt;           x8        x9       x10</span></span>
<span><span class="co">#&gt; C1 0.5976563 0.2572416 0.3823109</span></span>
<span><span class="co">#&gt; C2 0.4514389 0.5032435 0.4089434</span></span>
<span></span>
<span><span class="co"># diff-in-prob</span></span>
<span><span class="va">new_probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span> <span class="op">-</span> <span class="va">probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span></span>
<span><span class="co">#&gt;             x1         x2          x3          x4          x5          x6</span></span>
<span><span class="co">#&gt; C1 -0.08684659  0.3147958 -0.14930471 -0.17730924 -0.12855632 -0.03438758</span></span>
<span><span class="co">#&gt; C2  0.06632044 -0.1042591  0.06589754  0.08241196  0.07962923  0.02761056</span></span>
<span><span class="co">#&gt;             x7          x8         x9         x10</span></span>
<span><span class="co">#&gt; C1  0.08113647 0.014608959 -0.1101057 -0.08698181</span></span>
<span><span class="co">#&gt; C2 -0.03220874 0.003106965  0.0400351  0.04418685</span></span>
<span><span class="co"># risk ratio</span></span>
<span><span class="va">new_probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span> <span class="op">/</span> <span class="va">probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span></span>
<span><span class="co">#&gt;           x1        x2        x3        x4        x5        x6        x7</span></span>
<span><span class="co">#&gt; C1 0.8483994 1.5675841 0.6729001 0.6568785 0.8550951 0.8940509 1.0972046</span></span>
<span><span class="co">#&gt; C2 1.4491228 0.2243638 1.1572695 1.1995291 1.1514669 1.2015343 0.9598912</span></span>
<span><span class="co">#&gt;          x8        x9       x10</span></span>
<span><span class="co">#&gt; C1 1.025056 0.7002682 0.8146534</span></span>
<span><span class="co">#&gt; C2 1.006930 1.0864300 1.1211407</span></span></code></pre></div>
<p>At the extreme, when attention is placed exclusively on one feature.</p>
<p>We should expect <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>k</mi></msub><mo>‚à£</mo><mi>c</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(x_k \mid c)</annotation></semantics></math> to be 1.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"double"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span><span class="op">)</span> <span class="co"># all attention on dimension 3</span></span>
<span><span class="va">w2</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">w2</span>, names.arg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">w2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-22-1.png" width="100%"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">new_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/compute.html">compute</a></span><span class="op">(</span><span class="va">sim_data</span>, <span class="va">prototypes</span>, w <span class="op">=</span> <span class="va">w2</span>, <span class="va">g</span><span class="op">)</span></span>
<span><span class="va">new_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">new_out</span>, s <span class="op">=</span> <span class="fl">1e3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span></span>
<span><span class="co">#&gt;           x1        x2           x3        x4        x5        x6        x7</span></span>
<span><span class="co">#&gt; C1 0.4212941 0.1689949 9.999469e-01 0.5231397 0.6712993 0.2152812 0.7314927</span></span>
<span><span class="co">#&gt; C2 0.1989426 0.3644288 2.811951e-05 0.3926105 0.6355607 0.1918985 0.8767538</span></span>
<span><span class="co">#&gt;           x8        x9       x10</span></span>
<span><span class="co">#&gt; C1 0.4097318 0.3888849 0.3842530</span></span>
<span><span class="co">#&gt; C2 0.5598537 0.4612716 0.4137375</span></span></code></pre></div>
<p>Furthermore, marginal probability of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mn>1</mn></msub><annotation encoding="application/x-tex">c_1</annotation></semantics></math> should converge to the marginal probability of that feature with exclusive attention.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_probs</span><span class="op">$</span><span class="va">marginal</span></span>
<span><span class="co">#&gt; $categories</span></span>
<span><span class="co">#&gt;        C1        C2 </span></span>
<span><span class="co">#&gt; 0.4320062 0.5679938 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $features</span></span>
<span><span class="co">#&gt;    x1    x2    x3    x4    x5    x6    x7    x8    x9   x10 </span></span>
<span><span class="co">#&gt; 0.295 0.280 0.432 0.449 0.651 0.202 0.814 0.495 0.430 0.401</span></span></code></pre></div>
<p>Compositional Effects:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># diff-in-prob</span></span>
<span><span class="va">new_probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span> <span class="op">-</span> <span class="va">probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span></span>
<span><span class="co">#&gt;             x1         x2         x3           x4         x5          x6</span></span>
<span><span class="co">#&gt; C1 -0.15157026 -0.3856292  0.5434970  0.006386203 -0.2158776 -0.10928584</span></span>
<span><span class="co">#&gt; C2  0.05127596  0.2300112 -0.4189822 -0.020421740  0.1098404  0.05489672</span></span>
<span><span class="co">#&gt;             x7         x8           x9         x10</span></span>
<span><span class="co">#&gt; C1 -0.10320531 -0.1733156  0.021537656 -0.08503970</span></span>
<span><span class="co">#&gt; C2  0.07371856  0.1115218 -0.001936813  0.04898097</span></span>
<span></span>
<span><span class="co"># risk ratio</span></span>
<span><span class="va">new_probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span> <span class="op">/</span> <span class="va">probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span></span>
<span><span class="co">#&gt;           x1        x2           x3        x4        x5        x6        x7</span></span>
<span><span class="co">#&gt; C1 0.7354169 0.3047017 2.190705e+00 1.0123583 0.7566691 0.6632874 0.8763561</span></span>
<span><span class="co">#&gt; C2 1.3472414 2.7111691 6.710935e-05 0.9505565 1.2089333 1.4007008 1.0917999</span></span>
<span><span class="co">#&gt;           x8        x9       x10</span></span>
<span><span class="co">#&gt; C1 0.7027419 1.0586302 0.8187918</span></span>
<span><span class="co">#&gt; C2 1.2487482 0.9958187 1.1342840</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="back-to-correlations">Back to Correlations<a class="anchor" aria-label="anchor" href="#back-to-correlations"></a>
</h2>
<p>When all attention is placed on one feature, like in the previous example, we get to see something very intuitive about the compositions of all the other features.</p>
<p>If we compare</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xCondC1</span> <span class="op">&lt;-</span> <span class="va">new_probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span><span class="op">[</span><span class="st">"C1"</span>, <span class="op">]</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">new_probs</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">features</span></span>
<span></span>
<span><span class="va">xCondC1</span> <span class="op">-</span> <span class="va">x</span> <span class="co">## difference from baseline marginal probability</span></span>
<span><span class="co">#&gt;          x1          x2          x3          x4          x5          x6 </span></span>
<span><span class="co">#&gt;  0.12629413 -0.11100510  0.56794688  0.07413969  0.02029934  0.01328124 </span></span>
<span><span class="co">#&gt;          x7          x8          x9         x10 </span></span>
<span><span class="co">#&gt; -0.08250726 -0.08526823 -0.04111505 -0.01674697</span></span></code></pre></div>
<p>Look at the original correlation matrix:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">new_out</span><span class="op">$</span><span class="va">data</span>, <span class="st">"params"</span><span class="op">)</span><span class="op">$</span><span class="va">rho</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">rho</span><span class="op">[</span><span class="st">"x3"</span>, <span class="op">]</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;     x1     x2     x3     x4     x5     x6     x7     x8     x9    x10 </span></span>
<span><span class="co">#&gt;  0.146 -0.422  1.000  0.269 -0.014 -0.060 -0.270 -0.204 -0.078  0.006</span></span></code></pre></div>
<p>It seems like this difference from baseline is a linear function of the correlations between the features.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>corr <span class="op">=</span> <span class="va">rho</span><span class="op">[</span><span class="st">"x3"</span>, <span class="op">]</span>, diff <span class="op">=</span> <span class="va">xCondC1</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-27-1.png" width="100%"></p>
<p>This is certainly not the case when the attention weights are more spread out.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xCondC1</span> <span class="op">&lt;-</span> <span class="va">probs</span><span class="op">$</span><span class="va">conditional</span><span class="op">$</span><span class="va">features</span><span class="op">[</span><span class="st">"C1"</span>, <span class="op">]</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">probs</span><span class="op">$</span><span class="va">marginal</span><span class="op">$</span><span class="va">features</span></span>
<span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">data</span>, <span class="st">"params"</span><span class="op">)</span><span class="op">$</span><span class="va">rho</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>corr <span class="op">=</span> <span class="va">rho</span><span class="op">[</span><span class="st">"x3"</span>, <span class="op">]</span>, diff <span class="op">=</span> <span class="va">xCondC1</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-28-1.png" width="100%"></p>
<p>The mission is to find a formula that explains <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>‚à£</mo><mi>c</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">p(x\mid c)</annotation></semantics></math> as a function of the simulation parameters!</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/acastroaraujo/protoClassification/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/acastroaraujo/protoClassification/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing protoClassification</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>andr√©s castro ara√∫jo <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/acastroaraujo/protoClassification/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/acastroaraujo/protoClassification/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by andr√©s castro ara√∫jo.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
